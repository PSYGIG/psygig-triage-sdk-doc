Getting Started
===============

This short guide explains how to get started with `PSYGIG Triage SDK`. Before you can start instrumenting your applications, 
you need to download and install the latest version of the SDK.

:doc:`PSYGIG Triage SDK Download/Installation Guide <installation>`

**Quick Start** - using ``psymon``
----------------------------------
Without modifying your existing source code, you can instantly add instrumentation and crash reporting capabilities
to your application by using the ``psymon`` script to run your program. For example:

.. code-block:: bash

   psymon -c "/path/to/your/app --arg1 --arg2 --arg3"

By default, ``psymon`` enables all instrumentation capabilities. To enable selective instrumentation, specify the
instrumentation class with the appropriate :doc:`option <psymon-man>`.

See :doc:`psymon-man` for a complete list of options.

:doc:`Sample JSON output generated by psymon <sample-output>`

.. note::
    ``psymon`` is a work-in-progress. 
    Please :email:`contact us <info@psygig.com?subject=[PSYGIG Triage SDK] psymon>` if you are interested in beta-testing this feature. 

.. _libpsygig-linking:

**Advanced Setup** - Building your application with ``libpsygig``
-----------------------------------------------------------------
The rich feature set of the `PSYGIG Triage SDK` can be fully exploited via the :doc:`api/index`. The API can be accessed
by including a :doc:`single header file <api/file_include_psygigsdk.h>` and linking to the ``libpsygig`` shared library.

.. _basic-example:

**Basic example:** `Collecting system resource metrics`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This example enables period polling of system resource metrics and saves the data to a JSON file.

.. rubric:: `basic-example` source code

.. code-block:: c
    :linenos:

    #include "psygigsdk.h"

    int main(int argc, char **argv)
    {
        psygig_cfg              cfg;  // psygig agent configuration 
        psygig_agent_handle     pah;  // handle to psygig agent
        psygig_sink_cfg         sink; // output sink configuration

        int rc;

        const char* RESULTS_DIR = "results"; // directory to store the output JSON file
        const char* RESULTS_BASE = "sys"; // base filename of the output JSON file

        // Initialize agent
        rc = psygig_agent_init(&pah, &cfg); // Ignore return code for simplicity sake

        // Add a file sink for logging metrics to JSON
        sink.type = PSYGIG_SINK_FILE;
        sink.format = PSYGIG_DATA_FORMAT_JSON;
        strcpy(sink.file.dir,RESULTS_DIR);
        strcpy(sink.file.basename,RESULTS_BASE);
        rc = psygig_agent_add_sink(pah, &sink);  // Ignore return code for simplicity sake

        // Enable polling of system resources every 500ms
        rc = psygig_metric_enable_poll_system_resources(pah, 500);

        // Let it run for 15 seconds
        startts = time(NULL);
        endts = startts + 15;

        while (time(NULL) < endts)
        {
            millisleep(1000);
        }

        // We are done. Cleanup PSYGIG Agent.
        rc = psygig_agent_cleanup(&pah);

        return 0;
    }

.. rubric:: Building `basic-example` using ``gcc``

The compiler must be able to find the :doc:`psygigsdk.h <api/file_include_psygigsdk.h>` header and the 
``libpsygig`` shared library. With GCC, use the ``-I`` and ``-L`` options respectively to achieve this.

For `basic-example`, the compilation command is:

.. code-block:: bash

    gcc -I /opt/psyiage/include -L /opt/psyiage/lib -lpsygig basic-example.c -o basic-example

:sub:`Assuming PSYGIG Triage SDK was installed under /opt/psyiage`

.. rubric:: Building `basic-example` using ``cmake``

A better alternative for building programs using `PSYGIG Triage SDK` is to use ``cmake``, especially if you are
developing for several platforms. Assuming the following folder structure:

.. code-block:: bash

    basic-example\
       |- src\
       |   |- basic-example.c
       |- CMakeLists.txt

.. rubric:: `CMakeLists.txt` file

.. code-block:: cmake
    :linenos:

    cmake_minimum_required(VERSION 3.1)
    project(basic-example)

    # Add the source files to the binary
    add_executable(basic-example src/basic-example.c)

    # Add the psygigsdk.h folder to include path  
    target_include_directories(basic-example PRIVATE /opt/psyiage/include)

    # Link the libpsygig.so folder to the binary
    target_link_libraries(basic-example /opt/psyiage/lib/libpsygig.so)

:sub:`Assuming PSYGIG Triage SDK was installed under /opt/psyiage`

The following sequence of commands create a directory for building (avoid building in the source folder), builds
`basic-example` with ``cmake`` and then runs the program:

.. code-block:: bash

    mkdir build
    cd build
    cmake ..
    make
    ./basic-example
